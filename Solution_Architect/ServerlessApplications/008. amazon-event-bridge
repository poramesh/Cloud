Amazon EventBridge

Amazon EventBridge is a serverless event bus designed for building distributed, event-driven applications.
It can respond to state changes in both AWS resources and non-AWS resources.
Previously known as Amazon CloudWatch Events, it now exists as a separate service called EventBridge in the AWS Console.


Key Components of EventBridge

Event Sources:
Events are generated by event sources. These sources can include:
AWS Services: Such as EC2, S3, Lambda, etc.
Custom Applications: Events generated by your own applications.
Third-Party SaaS Applications: Events sent from external applications that integrate with AWS.

Event Bus:
Events from the sources are forwarded to the EventBridge event bus.
The event bus acts as a central hub that collects all incoming events.

Rules:
Rules define how events are filtered and processed.
These rules specify which events should be routed and what actions should be taken upon receiving those events.

Targets:
After the rule is processed, the event is forwarded to one or more targets.
Targets are services or applications where the event data is sent for processing.
Example targets include Lambda functions, Kinesis data streams, SNS topics, SQS queues, Step Functions, and more.


EventBridge Example Workflow

EC2 as an Event Source:
Suppose an EC2 instance undergoes a state change (e.g., termination).
The termination event is forwarded to the EventBridge event bus.

Processing the Event with a Rule:
A rule is processed to determine the type of event and what action to take.
The rule can be set to filter specific events, like events only for a certain EC2 instance ID or specific state changes (e.g., "terminated").

Forwarding to a Target:
The event is sent to a target. In this case, it could be an SNS topic.
The SNS topic sends out a notification to a specified recipient (e.g., via email).

Example Configuration:
Event source: EC2
Event pattern: Specific EC2 instance state change (e.g., termination).
Target: SNS notification sent to an email address.



Additional Example: CloudTrail as an Event Source

CloudTrail as an Event Source:
AWS CloudTrail monitors API actions for auditing purposes.
A specific event, like a S3 PUT bucket policy event, is recorded in CloudTrail.

Processing the CloudTrail Event:
The event is forwarded to the EventBridge event bus.
A rule is processed to filter the event based on its specifics (e.g., S3 bucket policy changes).

Sending the Event to a Target:
The event is forwarded to a target, such as an SNS topic, to notify stakeholders (e.g., via email).



Summary of Workflow
Event Source: AWS services (e.g., EC2), CloudTrail, or third-party applications.
EventBus: Events are forwarded to EventBridge's event bus.
Rules: Define which events to capture and how to process them.
Targets: Actions taken after the event is processed (e.g., sending notifications via SNS).

EventBridge is a powerful service for building scalable, event-driven architectures in AWS. It enables seamless
integration between AWS services and external applications by reacting to specific
events and automating workflows in real time.




:::HOOLL:::


Amazon EventBridge - EC2 Event Rule and SNS Integration

In this lesson, you learn how to use Amazon EventBridge to create an event bus and rule that triggers based on specific events happening in EC2.
Additionally, you'll integrate it with SNS for notification purposes.

Step-by-Step Guide:

1. EventBridge Rule Setup

Event Pattern:
Service: EC2 (Amazon Elastic Compute Cloud)
Event Type: EC2 Instance State-change Notification
Specific States: Choose terminated or any other state (e.g., shutdown).
You can also filter by specific instance IDs if needed.

Event Data: The rule will automatically match events like an instance being terminated, and generate event data that includes:
EC2 Instance State-change Notification
Instance details like instance ID, timestamp, and the region.

2. Pre-requisites

Before creating the EventBridge rule, a couple of resources need to be set up:

Create an SNS Topic for Notifications:
SNS Topic: Create a standard SNS topic (e.g., MyEmail) to which notifications will be sent.
Subscription: Create an email subscription for this SNS topic.
Enter your email address for notifications.
Confirm the subscription from your inbox.

CloudTrail Setup:
Ensure CloudTrail is configured to record management events (default setting).
This enables the tracking of EC2 API actions, such as instance termination, and sends data to EventBridge.


3. Launch EC2 Instance

Launch an EC2 instance to trigger the rule.
Choose default settings (e.g., proceed without a key pair) and launch the instance.


4. Create EventBridge Rule

>>Go to the Amazon EventBridge Console.
>>Select EventBridge Rule > Create Rule.
Name: e.g., terminate-instances
Event Bus: Use the default event bus.(check if this is same what we choose to get from the management evenets when i go throug the vides again)
Event Source: Select AWS services.
Event Type: Choose EC2 Instance State-change Notification.
State Filter: Choose terminated (to trigger notifications when instances are terminated).
Select Target: Choose SNS as the target for the event.
>>Select the previously created SNS topic (MyEmail).
>>Create the Rule: Click on Next and then Create the rule.

5. Testing the EventBridge Rule

Terminate EC2 Instance: Go back to EC2 and terminate the instance you launched earlier.
Notification: Check your inbox for an SNS notification.
The notification will contain event data in JSON format, which includes:
Event details (e.g., EC2 Instance State-change Notification)
Instance ID, region, timestamp, and event source (AWS EC2).

6. How to Use the Event Data:

The event data can be useful for several purposes:
Logging and Recording: Use this data to track EC2 state changes in a DynamoDB table or file.
Triggering Additional Actions: This event can trigger additional workflows, such as:
Deleting snapshots or AMIs.
Updating records in another AWS service.

7. Clean Up Resources:
After testing, you may want to delete the rule in EventBridge to stop receiving email notifications.
You can also delete the CloudTrail and other resources created (e.g., SNS topic) to prevent ongoing costs.


Summary:
Create an EventBridge event bus and rule that triggers on EC2 instance state changes.
Integrate SNS for notification purposes whenever an instance is terminated.
Use the event data generated by EventBridge for logging or triggering further actions in your applications.
This process can be extended to other AWS services for event-driven architecture, automating workflows based on state changes and events.

